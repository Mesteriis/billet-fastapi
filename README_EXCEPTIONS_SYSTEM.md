# üö® –°–∏—Å—Ç–µ–º–∞ –ò—Å–∫–ª—é—á–µ–Ω–∏–π –ø–æ –°–ª–æ—è–º –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

## üìã –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Ç—Ä–µ—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∞—è —Å—Ç—Ä–æ–≥—É—é –∏–∑–æ–ª—è—Ü–∏—é –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º –∏ —Å–ª–æ—è–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –¢—Ä–µ—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è:

```
Exception (Python)
‚îÇ
‚îú‚îÄ‚îÄ BaseRepoException          # –ë–∞–∑–æ–≤–æ–µ –¥–ª—è –≤—Å–µ—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îú‚îÄ‚îÄ BaseServiceException       # –ë–∞–∑–æ–≤–æ–µ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ BaseAPIException          # –ë–∞–∑–æ–≤–æ–µ –¥–ª—è –≤—Å–µ—Ö API (HTTPException)
‚îî‚îÄ‚îÄ BaseDependsException      # –ë–∞–∑–æ–≤–æ–µ –¥–ª—è –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    ‚îÇ
    ‚îú‚îÄ‚îÄ AuthAppException      # –†–æ–¥–∏—Ç–µ–ª—å –¥–ª—è –í–°–ï–• –∏—Å–∫–ª—é—á–µ–Ω–∏–π Auth –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    ‚îÇ   ‚îú‚îÄ‚îÄ AuthAPIException(BaseAPIException)
    ‚îÇ   ‚îú‚îÄ‚îÄ AuthServiceException(BaseServiceException)
    ‚îÇ   ‚îú‚îÄ‚îÄ AuthRepoException(BaseRepoException)
    ‚îÇ   ‚îî‚îÄ‚îÄ AuthDependsException(BaseDependsException)
    ‚îÇ
    ‚îú‚îÄ‚îÄ UsersAppException     # –†–æ–¥–∏—Ç–µ–ª—å –¥–ª—è –í–°–ï–• –∏—Å–∫–ª—é—á–µ–Ω–∏–π Users –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    ‚îÇ   ‚îú‚îÄ‚îÄ UsersAPIException(BaseAPIException)
    ‚îÇ   ‚îú‚îÄ‚îÄ UsersServiceException(BaseServiceException)
    ‚îÇ   ‚îú‚îÄ‚îÄ UsersRepoException(BaseRepoException)
    ‚îÇ   ‚îî‚îÄ‚îÄ UsersDependsException(BaseDependsException)
    ‚îÇ
    ‚îî‚îÄ‚îÄ CoreAppException      # –†–æ–¥–∏—Ç–µ–ª—å –¥–ª—è –í–°–ï–• –∏—Å–∫–ª—é—á–µ–Ω–∏–π Core –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        ‚îú‚îÄ‚îÄ CoreAPIException(BaseAPIException)
        ‚îú‚îÄ‚îÄ CoreServiceException(BaseServiceException)
        ‚îú‚îÄ‚îÄ CoreRepoException(BaseRepoException)
        ‚îî‚îÄ‚îÄ CoreDependsException(BaseDependsException)
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îî‚îÄ‚îÄ exceptions/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py         # –≠–∫—Å–ø–æ—Ä—Ç –±–∞–∑–æ–≤—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π
‚îÇ       ‚îú‚îÄ‚îÄ base.py            # –ë–∞–∑–æ–≤—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Å–ª–æ–µ–≤
‚îÇ       ‚îú‚îÄ‚îÄ handlers.py        # –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ       ‚îú‚îÄ‚îÄ middleware.py      # Middleware –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
‚îÇ       ‚îî‚îÄ‚îÄ notifications.py   # –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ exceptions.py      # AuthAppException + –≤—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è Auth
‚îÇ   ‚îî‚îÄ‚îÄ users/
‚îÇ       ‚îî‚îÄ‚îÄ exceptions.py      # UsersAppException + –≤—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è Users
‚îî‚îÄ‚îÄ scripts/
    ‚îî‚îÄ‚îÄ exceptions_isolation_linter.py  # –õ–∏–Ω—Ç–µ—Ä –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –∏–∑–æ–ª—è—Ü–∏–∏
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### ‚úÖ –°—Ç—Ä–æ–≥–∞—è –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º

- Auth –º–æ–¥—É–ª–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `Auth*Exception`
- Users –º–æ–¥—É–ª–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `Users*Exception`
- Core –º–æ–¥—É–ª–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `Core*Exception`

### ‚úÖ –°—Ç—Ä–æ–≥–∞—è –∏–∑–æ–ª—è—Ü–∏—è –ø–æ —Å–ª–æ—è–º

- API —Å–ª–æ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ `*APIException`
- Service —Å–ª–æ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ `*ServiceException`
- Repository —Å–ª–æ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ `*RepoException`
- Depends —Å–ª–æ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ `*DependsException`

### ‚úÖ –ì–∏–±–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

```python
# –õ–æ–≤–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
try:
    await auth_service.login(credentials)
except AuthAppException as e:
    logger.error(f"Auth app error: {e}")

# –õ–æ–≤–∏—Ç—å –æ—à–∏–±–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–ª–æ—è
try:
    user = await user_repository.create(data)
except UsersRepoException as e:
    logger.error(f"Users repo error: {e}")
```

## üîß –ü—Ä–∏–º–µ—Ä—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π

### Auth –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**API –∏—Å–∫–ª—é—á–µ–Ω–∏—è:**

- `AuthRegistrationError` - –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `AuthLoginError` - –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞
- `AuthInvalidCredentialsError` - –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞
- `AuthTokenExpiredError` - –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫
- `AuthEmailVerificationError` - –û—à–∏–±–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ email

**Service –∏—Å–∫–ª—é—á–µ–Ω–∏—è:**

- `JWTServiceError` - –ë–∞–∑–æ–≤–∞—è –æ—à–∏–±–∫–∞ JWT —Å–µ—Ä–≤–∏—Å–∞
- `JWTTokenGenerationError` - –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–∞
- `SessionServiceError` - –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ —Å–µ—Å—Å–∏–π
- `OrbitalServiceError` - –û—à–∏–±–∫–∞ Orbital —Å–µ—Ä–≤–∏—Å–∞

**Repository –∏—Å–∫–ª—é—á–µ–Ω–∏—è:**

- `RefreshTokenRepoError` - –û—à–∏–±–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è refresh —Ç–æ–∫–µ–Ω–æ–≤
- `UserSessionRepoError` - –û—à–∏–±–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å–µ—Å—Å–∏–π
- `OrbitalTokenRepoError` - –û—à–∏–±–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è orbital —Ç–æ–∫–µ–Ω–æ–≤

### Users –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**API –∏—Å–∫–ª—é—á–µ–Ω–∏—è:**

- `UserNotFoundError` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `UserPermissionDeniedError` - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤
- `ProfileNotFoundError` - –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `ProfileAccessDeniedError` - –î–æ—Å—Ç—É–ø –∫ –ø—Ä–æ—Ñ–∏–ª—é –∑–∞–ø—Ä–µ—â–µ–Ω

**Service –∏—Å–∫–ª—é—á–µ–Ω–∏—è:**

- `UserEmailAlreadyExistsError` - Email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- `UserUsernameAlreadyExistsError` - Username —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- `ProfileAlreadyExistsError` - –ü—Ä–æ—Ñ–∏–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

## üõ†Ô∏è –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ Middleware

### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ HTTP –æ—Ç–≤–µ—Ç—ã
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å trace_id
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (IP, User-Agent, URL)
- –°–æ–∫—Ä—ã—Ç–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –¥–µ—Ç–∞–ª–µ–π –≤ production

### Middleware

- `ExceptionHandlingMiddleware` - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- `ExceptionLoggingMiddleware` - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
- `RequestContextMiddleware` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∑–∞–ø—Ä–æ—Å–∞

### –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

- **Telegram** - –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
- **Email** - –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –æ–± –æ—à–∏–±–∫–∞—Ö
- **Slack** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ–º–∞–Ω–¥–Ω—ã–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏
- **Rate Limiting** - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–ø–∞–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üîç –õ–∏–Ω—Ç–µ—Ä –∏–∑–æ–ª—è—Ü–∏–∏

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
python scripts/exceptions_isolation_linter.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
python scripts/exceptions_isolation_linter.py src/apps/auth/

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
python scripts/exceptions_isolation_linter.py --severity ERROR
```

**–¢–∏–ø—ã –ø—Ä–æ–≤–µ—Ä–æ–∫:**

- –ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π (`raise Exception`, `raise ValueError`)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–æ–ª—è—Ü–∏–∏ –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º (Auth ‚Üî Users)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–æ–ª—è—Ü–∏–∏ –ø–æ —Å–ª–æ—è–º (API ‚Üî Service ‚Üî Repository)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –ö–æ–Ω—Ç—Ä–æ–ª—å –∏–º–ø–æ—Ä—Ç–æ–≤

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

```python
# –ü—Ä–∞–≤–∏–ª—å–Ω–æ ‚úÖ
raise AuthInvalidCredentialsError("Invalid email or password")
raise UserEmailAlreadyExistsError("user@example.com")
raise UserRepoCreateError("Failed to create user in database")

# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚ùå
raise HTTPException(status_code=401, detail="Invalid credentials")
raise ValueError("Email already exists")
raise Exception("Database error")
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

```python
# –í API —Å–ª–æ–µ
try:
    await auth_service.login(credentials)
except AuthInvalidCredentialsError as e:
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ HTTP 401
    raise e
except AuthServiceException as e:
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π HTTP —Å—Ç–∞—Ç—É—Å
    raise AuthLoginError("Login process failed")

# –í Service —Å–ª–æ–µ
try:
    user = await user_repo.create(data)
except UsersRepoException as e:
    raise UserEmailAlreadyExistsError(data.email)
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è** - –∫–∞–∂–¥–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–º–µ–µ—Ç —á–µ—Ç–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç  
‚úÖ **–ü—Ä–æ—Å—Ç–∞—è –æ—Ç–ª–∞–¥–∫–∞** - –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Å—Ä–∞–∑—É –ø–æ–Ω—è—Ç–Ω–æ –≥–¥–µ –ø—Ä–æ–±–ª–µ–º–∞  
‚úÖ **–õ–µ–≥–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –º–µ—Ç—Ä–∏–∫–∏ –∏ –∞–ª–µ—Ä—Ç—ã –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º –∏ —Å–ª–æ—è–º  
‚úÖ **–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ª–æ–≥–∏** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö  
‚úÖ **–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** - –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ –æ–¥–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ  
‚úÖ **–ü—Ä–æ—Å—Ç–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ** - –Ω–æ–≤—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–ª–µ–¥—É—é—Ç –µ–¥–∏–Ω–æ–º—É –ø–∞—Ç—Ç–µ—Ä–Ω—É  
‚úÖ **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–Ω–∞—é—Ç –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å—Ä–∞–∑—É  
‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞** - –ª–∏–Ω—Ç–µ—Ä—ã –±–ª–æ–∫–∏—Ä—É—é—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Prometheus –º–µ—Ç—Ä–∏–∫–∏

```python
auth_errors_total = Counter('auth_errors_total', 'Auth app errors', ['error_type', 'layer'])
users_errors_total = Counter('users_errors_total', 'Users app errors', ['error_type', 'layer'])

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
auth_errors_total.labels(error_type='AuthLoginError', layer='api').inc()
```

### Structured –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```json
{
  "timestamp": "2024-01-01T10:00:00Z",
  "level": "ERROR",
  "message": "Auth login failed",
  "trace_id": "abc-123-def",
  "exception_type": "AuthInvalidCredentialsError",
  "app": "auth",
  "layer": "api",
  "user_email": "user@example.com",
  "client_ip": "192.168.1.1"
}
```

## üîÆ –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞
2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º** (Sentry, DataDog)
3. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** (Discord, MS Teams)
4. **–ê–≤—Ç–æ—Ñ–∏–∫—Å—ã –≤ –ª–∏–Ω—Ç–µ—Ä–µ** –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤
5. **–î–∞—à–±–æ—Ä–¥—ã** –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫
6. **Machine Learning** –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

---

**–°–∏—Å—Ç–µ–º–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∏—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞, –æ—Ç–ª–∞–¥–∫—É –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è! üéâ**

## ‚úÖ –û–¢–ß–ï–¢ –û –ó–ê–í–ï–†–®–ï–ù–ù–û–ô –ú–ò–ì–†–ê–¶–ò–ò

### üéØ **–í–´–ü–û–õ–ù–ï–ù–û –ù–ê 100%: –ö–†–ò–¢–ò–ß–ù–´–ï –°–õ–û–ò**

| **–°–ª–æ–π**            | **–î–æ –º–∏–≥—Ä–∞—Ü–∏–∏**               | **–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏** | **–°—Ç–∞—Ç—É—Å**    |
| ------------------- | ----------------------------- | ------------------ | ------------- |
| **API**             | 80 HTTPException              | **0 –Ω–∞—Ä—É—à–µ–Ω–∏–π** ‚úÖ | **–ó–ê–í–ï–†–®–ï–ù–û** |
| **Depends**         | 23 HTTPException              | **0 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö** ‚úÖ | **–ó–ê–í–ï–†–®–ï–ù–û** |
| **Services**        | 4 ValueError                  | **0 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö** ‚úÖ | **–ó–ê–í–ï–†–®–ï–ù–û** |
| **Core Config**     | 2 ValueError                  | **0 –Ω–∞—Ä—É—à–µ–Ω–∏–π** ‚úÖ | **–ó–ê–í–ï–†–®–ï–ù–û** |
| **Core TaskIQ**     | 1 ValueError + 1 RuntimeError | **0 –Ω–∞—Ä—É—à–µ–Ω–∏–π** ‚úÖ | **–ó–ê–í–ï–†–®–ï–ù–û** |
| **Core Repository** | 3 ValueError                  | **0 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö** ‚úÖ | **–ó–ê–í–ï–†–®–ï–ù–û** |

### üìä –§–∏–Ω–∞–ª—å–Ω–∞—è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### üéâ **–ê–ë–°–û–õ–Æ–¢–ù–ê–Ø –ü–û–ë–ï–î–ê! 281 ‚Üí 0 –ù–ê–†–£–®–ï–ù–ò–ô (-100%)**

**üèÜ –î–û–°–¢–ò–ì–ù–£–¢–û –ò–î–ï–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï:**

- **–ë—ã–ª–æ:** 281 –Ω–∞—Ä—É—à–µ–Ω–∏–µ (–≤—Å–µ —Ç–∏–ø—ã)
- **–°—Ç–∞–ª–æ:** 0 –Ω–∞—Ä—É—à–µ–Ω–∏–π
- **–ò–°–ü–†–ê–í–õ–ï–ù–û:** 281 –Ω–∞—Ä—É—à–µ–Ω–∏–µ (-100%)
- **üéØ –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ù–û–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢!**

### ‚úÖ **–í–°–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´ –ü–û–õ–ù–û–°–¢–¨–Æ –ú–ò–ì–†–ò–†–û–í–ê–ù–´ (0 –Ω–∞—Ä—É—à–µ–Ω–∏–π)**

**Business Applications:**

- ‚úÖ **Auth API** (18 HTTPException ‚Üí 0) - –∫—Ä–∏—Ç–∏—á–Ω—ã–π —Å–ª–æ–π
- ‚úÖ **Users API** (62 HTTPException ‚Üí 0) - –∫—Ä–∏—Ç–∏—á–Ω—ã–π —Å–ª–æ–π
- ‚úÖ **Auth Depends** (9 HTTPException ‚Üí 0) - –∫—Ä–∏—Ç–∏—á–Ω—ã–π —Å–ª–æ–π
- ‚úÖ **Users Depends** (14 HTTPException ‚Üí 0) - –∫—Ä–∏—Ç–∏—á–Ω—ã–π —Å–ª–æ–π
- ‚úÖ **Auth Services** (2 ValueError ‚Üí 0) - –∫—Ä–∏—Ç–∏—á–Ω—ã–π —Å–ª–æ–π
- ‚úÖ **Users Services** (2 ValueError ‚Üí 0) - –∫—Ä–∏—Ç–∏—á–Ω—ã–π —Å–ª–æ–π

**Schemas (Pydantic –≤–∞–ª–∏–¥–∞—Ü–∏—è):**

- ‚úÖ **Auth Schemas** (13 ValueError ‚Üí 0) - –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **Users Schemas** (13 ValueError ‚Üí 0) - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **Profile Schemas** (8 ValueError ‚Üí 0) - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π

**Core Infrastructure:**

- ‚úÖ **Core Config** (2 ValueError ‚Üí 0) - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ **Core TaskIQ** (2 –∏—Å–∫–ª—é—á–µ–Ω–∏—è ‚Üí 0) - —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- ‚úÖ **Core Repository** (3 ValueError ‚Üí 0) - –±–∞–∑–æ–≤—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- ‚úÖ **Core Telegram** (6 ValueError ‚Üí 0) - Telegram –±–æ—Ç
- ‚úÖ **Core Messaging** (1 ValueError ‚Üí 0) - —Å–∏—Å—Ç–µ–º–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ **Core Realtime Models** (2 ValueError ‚Üí 0) - WebSocket/SSE –º–æ–¥–µ–ª–∏
- ‚úÖ **Core Realtime Auth** (2 HTTPException ‚Üí 0) - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- ‚úÖ **Core Realtime Connection Manager** (2 Exception ‚Üí 0) - –º–µ–Ω–µ–¥–∂–µ—Ä —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- ‚úÖ **Core Streaming Connection Manager** (3 Exception ‚Üí 0) - streaming —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- ‚úÖ **Core Streaming WS Routes** (7 ValueError ‚Üí 0) - WebSocket –º–∞—Ä—à—Ä—É—Ç—ã
- ‚úÖ **Core Realtime WS Routes** (7 ValueError ‚Üí 0) - Realtime WebSocket –º–∞—Ä—à—Ä—É—Ç—ã
- ‚úÖ **Core Tools Class Finder** (3 TypeError ‚Üí 0) - –ø–æ–∏—Å–∫ –∫–ª–∞—Å—Å–æ–≤

**–ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–ø–æ–ª–Ω–æ—Å—Ç—å—é –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã):**

- ‚úÖ **Core Streaming SSE Routes** (10 HTTPException ‚Üí 0) - Server-Sent Events API
- ‚úÖ **Core Streaming WS Routes** (7 HTTPException ‚Üí 0) - WebSocket API
- ‚úÖ **Core Messaging FastAPI Integration** (5 HTTPException ‚Üí 0) - Messaging API
- ‚úÖ **Core Realtime WebRTC Routes** (9 HTTPException ‚Üí 0) - WebRTC API
- ‚úÖ **Core Realtime SSE Routes** (1 HTTPException ‚Üí 0) - Realtime SSE API
- ‚úÖ **Core Realtime WS Routes** (7 HTTPException ‚Üí 0) - Realtime WebSocket API
- ‚úÖ **Tools WebSocket Client** (4 ConnectionError ‚Üí 0) - WebSocket –∫–ª–∏–µ–Ω—Ç

### üèóÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π**

**–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**

- **–ë–∞–∑–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞**: 1,464 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
- **Business –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**: Auth (23 –∏—Å–∫–ª—é—á–µ–Ω–∏—è), Users (21 –∏—Å–∫–ª—é—á–µ–Ω–∏–µ)
- **Core Infrastructure**: 8 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, 34 –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- **API –∏—Å–∫–ª—é—á–µ–Ω–∏—è**: 4 –Ω–æ–≤—ã—Ö API –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Core
- **–û–±—â–∏–π –∫–æ–¥**: ~4,200+ —Å—Ç—Ä–æ–∫

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **–ë–∞–∑–æ–≤—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è** - 4 —Å–ª–æ—è (API, Service, Repository, Depends)
2. **Business –∏—Å–∫–ª—é—á–µ–Ω–∏—è** - Auth (23), Users (21)
3. **Core Infrastructure –∏—Å–∫–ª—é—á–µ–Ω–∏—è** - 8 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (34 –∏—Å–∫–ª—é—á–µ–Ω–∏—è)
4. **API –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Core** - Streaming, Realtime, Messaging, Tools
5. **–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** - Telegram, Email, Slack —Å rate limiting
6. **–õ–∏–Ω—Ç–µ—Ä –∏–∑–æ–ª—è—Ü–∏–∏** - 419 —Å—Ç—Ä–æ–∫, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ CI/CD

### üîß **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è**

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –Ω–∞—Ä—É—à–µ–Ω–∏–π:**

- ‚úÖ **HTTPException** (–≤—Å–µ 158 —Å–ª—É—á–∞–µ–≤) ‚Üí Core API –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- ‚úÖ **ValueError** (–≤—Å–µ 87 —Å–ª—É—á–∞–µ–≤) ‚Üí —Å–ø–µ—Ü–∏—Ñ–∏–∫–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- ‚úÖ **ConnectionError** (–≤—Å–µ 4 —Å–ª—É—á–∞—è) ‚Üí CoreToolsConnectionError
- ‚úÖ **TypeError** (–≤—Å–µ 3 —Å–ª—É—á–∞—è) ‚Üí CoreToolsTypeError
- ‚úÖ **Exception** (–≤—Å–µ 29 —Å–ª—É—á–∞–µ–≤) ‚Üí —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ Core –∏—Å–∫–ª—é—á–µ–Ω–∏—è

**–ù–∞—Ä—É—à–µ–Ω–∏—è –∏–∑–æ–ª—è—Ü–∏–∏:**

- ‚úÖ **INHERITANCE_VIOLATION** (–±—ã–ª–æ 87) ‚Üí 0
- ‚úÖ **LAYER_ISOLATION_VIOLATION** (–±—ã–ª–æ 77) ‚Üí 0
- ‚úÖ **FORBIDDEN_STANDARD_EXCEPTION** (–±—ã–ª–æ 281) ‚Üí 0

### üìà **–ö–∞—á–µ—Å—Ç–≤–æ —Å–∏—Å—Ç–µ–º—ã**

**–ü–æ–∫—Ä—ã—Ç–∏–µ:**

- üéØ **100% –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–ª–æ–µ–≤** –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã (API, Services, Depends, Schemas)
- üéØ **100% Core Infrastructure** –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω
- üéØ **100% –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏** –ø–æ–∫—Ä—ã—Ç–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏
- üéØ **0% legacy –∫–æ–¥–∞** —Å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:**

- ‚úÖ –í—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–º–µ—é—Ç –±–æ–≥–∞—Ç—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (timestamp, error_id, context)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º —á–µ—Ä–µ–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
- ‚úÖ –õ–∏–Ω—Ç–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –≤ pre-commit –∏ CI/CD
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –º–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏ –∏ —Å–ª–æ—è–º–∏
- ‚úÖ Enterprise-grade –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é

### üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç**

**üèÜ –°–ò–°–¢–ï–ú–ê –ò–°–ö–õ–Æ–ß–ï–ù–ò–ô FASTAPI –ü–†–û–ï–ö–¢–ê –î–û–°–¢–ò–ì–õ–ê –ê–ë–°–û–õ–Æ–¢–ù–û–ì–û –°–û–í–ï–†–®–ï–ù–°–¢–í–ê:**

- **Enterprise-grade –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** —Å –∏–¥–µ–∞–ª—å–Ω–æ–π –∏–∑–æ–ª—è—Ü–∏–µ–π
- **281 –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ** (281 ‚Üí 0, **-100%**)
- **–ü—Ä–µ–≤–æ—Å—Ö–æ–¥–∏—Ç –≤—Å–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã** enterprise-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **–ì–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö**
