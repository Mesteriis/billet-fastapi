repos:
  # –û–±—â–∏–µ —Ö—É–∫–∏
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
      - id: check-added-large-files
        args: ["--maxkb=1000"]
      - id: check-merge-conflict
      - id: debug-statements
      - id: check-docstring-first
      - id: check-json
      - id: pretty-format-json
        args: ["--autofix"]

  # Python —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  - repo: https://github.com/psf/black
    rev: 23.3.0
    hooks:
      - id: black
        language_version: python3
        args: ["--line-length=120"]

  # –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤
  - repo: https://github.com/pycqa/isort
    rev: 5.12.0
    hooks:
      - id: isort
        args: ["--profile=black", "--line-length=120"]

  # –õ–∏–Ω—Ç–∏–Ω–≥ Python
  - repo: https://github.com/pycqa/flake8
    rev: 6.0.0
    hooks:
      - id: flake8
        args:
          [
            "--max-line-length=120",
            "--ignore=E203,W503,E501",
            "--exclude=migrations,__pycache__,.venv,venv",
          ]

  # Pylint –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
  - repo: local
    hooks:
      - id: pylint-similarities
        name: PyLint Similarity Check
        entry: pylint
        language: system
        args: ["--disable=all", "--enable=duplicate-code"]
        files: \.py$
        exclude: ^(tests/|migrations/|__pycache__/)

  # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ —Å mypy (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ make typecheck)
  # - repo: https://github.com/pre-commit/mirrors-mypy
  #   rev: v1.13.0
  #   hooks:
  #     - id: mypy
  #       additional_dependencies: [
  #         pydantic,
  #         sqlalchemy,
  #         types-redis,
  #         types-pytz,
  #         types-passlib,
  #         types-setuptools,
  #       ]
  #       args: ['--config-file=pyproject.toml', '--explicit-package-bases']
  #       exclude: ^(migrations/versions/|migrations/env\.py|src/core/migrations/__init__\.py|var/|backups/|htmlcov/)

  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.5
    hooks:
      - id: bandit
        args: ["-r", "src/", "-f", "json"]
        exclude: ^tests/

  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ (–Ω–∞—à —Å–∫—Ä–∏–ø—Ç)
  - repo: local
    hooks:
      - id: check-code-duplication
        name: Check Code Duplication
        entry: python scripts/check_duplication.py
        language: system
        args: ["--min-lines=7"]
        pass_filenames: false
        always_run: true

  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª
  - repo: local
    hooks:
      - id: architecture-check
        name: Architecture Check
        entry: python scripts/check_architecture.py
        language: system
        pass_filenames: false
        always_run: true

      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ –º–µ–∂–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏
      - id: inter-app-imports-check
        name: Inter-App Imports Check
        entry: python scripts/inter_app_imports_linter.py
        language: system
        args: ["src/apps"]
        pass_filenames: false
        always_run: true

      # –ü—Ä–æ–≤–µ—Ä–∫–∞ —è–∑—ã–∫–∞ –∏ —Ñ–æ—Ä–º–∞—Ç–∞ docstring
      - id: docstring-language-check
        name: Docstring Language & Format Check
        entry: python scripts/check_docstring_language.py
        language: system
        files: \.py$
        exclude: ^(tests/|migrations/|scripts/|__pycache__/|.*/__init__\.py|src/main\.py|src/cli\.py)

  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
  - repo: local
    hooks:
      - id: docs-check
        name: Documentation Check
        entry: bash
        language: system
        args:
          [
            "-c",
            'find src/ -name "*.py" -path "*/src/*" ! -path "*/tests/*" ! -name "__init__.py" -exec grep -L "\"\"\"" {} \; | head -10',
          ]
        pass_filenames: false

  # –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –æ—Ç –º—É—Å–æ—Ä–∞ (–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
  - repo: local
    hooks:
      # –ë—ã—Å—Ç—Ä–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤ —Ä–µ–∂–∏–º–µ dry-run (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
      - id: cleanup-project-dry
        name: Project Cleanup (Dry Run)
        entry: python scripts/cleanup_project.py
        language: system
        args: ["--dry-run"]
        pass_filenames: false
        always_run: true
        stages: [pre-commit]

      # –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ PRECOMMIT_CLEANUP=full)
      - id: cleanup-project-full
        name: Project Cleanup (Full)
        entry: bash
        language: system
        args:
          [
            "-c",
            'if [ "$PRECOMMIT_CLEANUP" = "full" ]; then python scripts/cleanup_project.py; else echo "üö´ –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PRECOMMIT_CLEANUP=full –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏"; fi',
          ]
        pass_filenames: false
        always_run: true
        stages: [manual]

      # –ü–æ–¥—Ä–æ–±–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –≤—ã–≤–æ–¥–æ–º (–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ PRECOMMIT_CLEANUP=verbose)
      - id: cleanup-project-verbose
        name: Project Cleanup (Verbose)
        entry: bash
        language: system
        args:
          [
            "-c",
            'if [ "$PRECOMMIT_CLEANUP" = "verbose" ]; then python scripts/cleanup_project.py --verbose; else echo "üö´ –ü–æ–¥—Ä–æ–±–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PRECOMMIT_CLEANUP=verbose –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏"; fi',
          ]
        pass_filenames: false
        always_run: true
        stages: [manual]

ci:
  autofix_commit_msg: "[pre-commit.ci] auto fixes from pre-commit.com hooks"
  autofix_prs: true
  autoupdate_branch: ""
  autoupdate_commit_msg: "[pre-commit.ci] pre-commit autoupdate"
  autoupdate_schedule: weekly
  skip:
    [
      pytest-fast,
      check-project-structure,
      cleanup-project-dry,
      cleanup-project-full,
      cleanup-project-verbose,
      inter-app-imports-check,
    ]
  submodules: false

default_stages: [pre-commit]
fail_fast: false
default_language_version:
  python: python3
