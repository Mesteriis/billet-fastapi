# =============================================================================
# RabbitMQ конфигурация для FastAPI проекта
# =============================================================================

# =============================================================================
# Основные настройки
# =============================================================================
# Включаем новый формат конфигурации
management.tcp.port = 15672
listeners.tcp.default = 5672

# =============================================================================
# Безопасность
# =============================================================================
# Отключаем гостевого пользователя в production
loopback_users.guest = false

# Настройки SSL (если используется)
# ssl_options.cacertfile = /etc/rabbitmq/ssl/ca_certificate.pem
# ssl_options.certfile   = /etc/rabbitmq/ssl/server_certificate.pem
# ssl_options.keyfile    = /etc/rabbitmq/ssl/server_key.pem
# ssl_options.verify     = verify_peer
# ssl_options.fail_if_no_peer_cert = true

# =============================================================================
# Производительность и память
# =============================================================================
# Настройка высокого водяного знака памяти (60% от доступной)
vm_memory_high_watermark.relative = 0.6

# Настройка дискового места (минимум 2GB свободного места)
disk_free_limit.absolute = 2GB

# Максимальное количество подключений
connection_max = 1000

# Максимальное количество каналов на подключение
channel_max = 2047

# =============================================================================
# Настройки очередей
# =============================================================================
# Максимальная длина очереди по умолчанию
default_vhost_limits.max_queues = 1000
default_vhost_limits.max_connections = 500
default_vhost_limits.max_channels = 1000

# Политика по умолчанию для mirror queues (кластеризация)
# default_policies.ha-mode = all
# default_policies.ha-sync-mode = automatic

# =============================================================================
# Heartbeat и таймауты
# =============================================================================
# Heartbeat интервал (секунды)
heartbeat = 60

# Таймаут для handshake
handshake_timeout = 10000

# =============================================================================
# Логирование
# =============================================================================
# Уровень логирования
log.console.level = info
log.file.level = info

# Формат логов
log.console.formatter = json
log.file.formatter = json

# Ротация логов
log.file.rotation.size = 10485760
log.file.rotation.count = 5

# =============================================================================
# Management UI
# =============================================================================
# Включаем management плагин
management.listener.port = 15672
management.listener.ssl = false

# Настройки rate limiting для management API
management.rates_mode = basic

# Интервал сбора статистики
collect_statistics_interval = 5000

# =============================================================================
# TCP настройки
# =============================================================================
# TCP настройки для лучшей производительности
tcp_listen_options.backlog = 4096
tcp_listen_options.nodelay = true
tcp_listen_options.sndbuf = 196608
tcp_listen_options.recbuf = 196608

# =============================================================================
# Cluster настройки (для будущего масштабирования)
# =============================================================================
# cluster_formation.peer_discovery_backend = rabbit_peer_discovery_k8s
# cluster_formation.k8s.host = kubernetes.default.svc.cluster.local
# cluster_formation.node_cleanup.interval = 30
# cluster_formation.node_cleanup.only_log_warning = false

# =============================================================================
# Мониторинг и метрики
# =============================================================================
# Включаем Prometheus метрики
prometheus.tcp.port = 15692

# =============================================================================
# Политики и определения
# =============================================================================
# Автоматическое удаление неиспользуемых очередей
# definitions.import_backend = file
# definitions.file = /etc/rabbitmq/definitions.json

# =============================================================================
# Плагины (автозагрузка)
# =============================================================================
# Список плагинов будет загружен из enabled_plugins файла 